docno="lists-000-3915782"
received="Fri Oct  1 02:19:08 1999"
isoreceived="19991001061908"
sent="Fri, 01 Oct 1999 15:18:55 +0900"
isosent="19991001061855"
name="Kenichi Numata"
email="Kenichi.Numata@fujixerox.co.jp"
subject="Bug: Infinite loop in ParseList() (again)"
id="37F4524F.D8D8A4C2@fujixerox.co.jp"
charset="us-ascii"
expires="-1"


To:html-tidy@w3.org

Thanks to Dave Raggett, the bug which I reported is now fixed.

But There are a few more cases which causes infinite loop
in the newest version of tidy.
----
Example 1.

<html>
<head><title>Loop 1</title></head>
<body>
<ol>
<font color="red"><li>Item 1</li></font>
<font color="green"><li>Item 2</li></font>
</ol>
</body>
</html>
----
Example 2. (This is what Bj?rn H?hrmann reported.)

<html>
<head><title>Loop 2</title></head>
<body>
<ol>
<ul>
</ol>
</body>
</html>
----

I attach a quick patch for this problem.
I hope it doesn't affect anything else.

Regards,
-- 
Kenichi Numata
IT Business Development Dept., Fuji Xerox Co., Ltd.
E-Mail: Kenichi.Numata@fujixerox.co.jp
*** tidy27sep99\parser.cMon Sep 27 10:15:50 1999
--- parser.cFri Oct 01 14:40:42 1999
***************
*** 651,657 ****
                          return;
                      }
  
!                     node = InferredTag(lexer, "ul");
                  }
                  else if (node->tag->model & CM_DEFLIST)
                  {
--- 651,660 ----
                          return;
                      }
  
!                     if (element->was)
!                         node = InferredTag(lexer, element->was->name);
!                     else
!                         node = InferredTag(lexer, "ul");
                  }
                  else if (node->tag->model & CM_DEFLIST)
                  {
***************
*** 1399,1404 ****
--- 1402,1414 ----
                      TrimEmptyElement(lexer, list);
                      return;
                  }
+             }
+ 
+             if (node->tag && node->tag->model & CM_BLOCK)
+             {
+                 ReportWarning(lexer, list, node, DISCARDING_UNEXPECTED);
+                 FreeNode(node);
+                 continue;
              }
          }
  



