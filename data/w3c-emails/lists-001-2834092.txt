docno="lists-001-2834092"
received="Wed Dec 20 04:17:47 2000"
isoreceived="20001220091747"
sent="Wed, 20 Dec 2000 01:17:18 -0800"
isosent="20001220091718"
name="Gary L Peskin"
email="garyp@firstech.com"
subject="Bug+Fix for inserted nodes"
id="3A40791E.E135F0DD@firstech.com"
charset="us-ascii"
expires="-1"


To: Html-Tidy<html-tidy@w3.org>

Inserted nodes are being created with incorrect node->end values in
certain cases.

The following java example program (provided by
dglo@users.sourceforge.net) illustrates the problem:



import java.io.ByteArrayInputStream; 
import org.w3c.tidy.Tidy; 

public class NodeBug 
{ 
  public static final void main(String[] args) 
  { 
    String badHTML = "<html><font><center></center></p>\n\n</html>"; 

    Tidy tidy = new Tidy(); 
    tidy.parseDOM(new ByteArrayInputStream(badHTML.getBytes()),
null).cloneNode(true); 
  } 
} 

Similar results are obtained with the parse() method.  I don't have a c
compiler so I can't reliably produce c code here which causes the same
problem but it should look approximately the same.

The problem occurs, I believe, at istack.c line 242 in method
InsertedToken.  The line 

  node->end = lexer->txtstart;

should be changed to read

  node->end = lexer->txtend;

Gary



