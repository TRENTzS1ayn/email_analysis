docno="lists-092-10195548"
received="Mon Jan 15 06:08:04 2001"
isoreceived="20010115110804"
sent="Mon, 15 Jan 2001 12:07:56 +0100"
isosent="20010115110756"
name="Irene VATTON"
email="Irene.Vatton@inrialpes.fr"
subject="Re: PATCH: configure.in fixes; minor doc fix; bug report"
id="200101151107.MAA15664@tahiti.inrialpes.fr"
charset="us-ascii"
inreplyto="pmoulder&#64;csse.monash.edu.au"
expires="-1"


To: Peter Moulder<pmoulder@csse.monash.edu.au>
cc:www-amaya-dev@w3.org


Hi Peter,

Thanks for the report and patches. I integrated them in the CVS base.

> Note: after applying this patch, a couple of existing problems are
> highlighted:
> 
>   i) libjpeg and libpng are built even when external libjpeg and/or
>      libpng are to be used.

Fixed, but you have to explicitly set --without-included-jpeg because the 
default
is --with-included-jpeg


>   ii) `-I../../libpng -I../../libpng/zlib' is being used even when
>       external libpng and zlib are to be used.

Fixed.

>       Comments in configure.in suggest that this is because Amaya is
>       using a modified png header file, but there's no note as to which
>       header file is modified or why.  Using a header file of one
>       version and linking against a library of another version is asking
>       for trouble (and indeed may have contributed to item iii in this
>       list).
> 
>       I couldn't find version 1.0.1 of libpng to do a diff against,
>       but comparing with 1.0.2, my best guess is that the one and only
>       change is to make it not be a compile error to have already
>       #include'd setjmp.h before #include'ing pngconf.h.  Judging by
>       the comment added by the Debian maintainer to pngconf.h, it
>       would appear that the change wasn't even desirable in the first
>       place:

This is related to your point iii). The last library png (1.08 I guess)
is not compatible and Amaya crashes.

> #    ifdef _SETJMP_H
> /* Explanation added by debian maintainer Philippe Troin <phil@fifi.org>.
>    There are two versions of setjmp, depending wether or not we compile for
>    BSD. They are incompatible and can cause crashes. The PNG people force
>    here a unique behavior for setjmp. It you get the error below,
>    then include <png.h> before <setjmp.h>.
> */
> #error png.h already includes setjmp.h with some additional fixup.
> #    endif
> 
> 
>   iii) png_read_init bombs out in current libpng (unless libpng was
>        compiled with PNG_LEGACY_SUPPORTED; see pngread.c in current
>        libpng distribution).

Nabil Layaida is looking at a possible update of the Amaya code for working
with a more recent version of the library png. Meanwhile it's preferable
to work with the provided version of that library.

> Given problems ii and iii above, you might want to make the png test
> pattern be `1\.0\.1' instead of `1\.0\..*'.  (I don't know what the upper
> limit for problems is; maybe make it `1\.0\.[1-7]' and reduce the range
> when people report errors.)
> 
> pjm.

-- 
     Irene.



