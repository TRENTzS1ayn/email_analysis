docno="lists-093-16597069"
received="Sun Jan 17 20:07:48 1999"
isoreceived="19990118010748"
sent="Sun, 17 Jan 1999 17:04:26 -0800"
isosent="19990118010426"
name="Tim Baker"
email="dbaker@direct.ca"
subject="winthotcompilers.c patch"
id="36A2889A.289C3FDE@direct.ca"
charset="us-ascii"
expires="-1"


To:www-amaya@w3.org

I've attached a small patch which fixes problems with winthotcompilers.c

in the Amaya 1.4a distribution.

Hope it comes across okay.

-- Tim Baker
--- winthotcompilers-orig.cFri Jan 15 21:01:10 1999
+++ winthotcompilers-patch.cFri Jan 15 20:58:18 1999
@@ -656,14 +656,14 @@
                                          currentFile = (char*) 0;
   }
                                       if (SrcFileName) {
-                                         free (currentFile);
-                                         currentFile = (char*) 0;
+                                         free (SrcFileName);
+                                         SrcFileName = (char*) 0;
   }
                                       if (WorkFileName) {
-                                         free (currentFile);
-                                         currentFile = (char*) 0;
+                                         _unlink (WorkFileName);
+                                         free (WorkFileName);
+                                         WorkFileName = (char*) 0;
   }
-                                      _unlink (WorkFileName);
                                       if (result == FATAL_EXIT_CODE)
                                          return result;
                                       len = strlen (WorkPath);
@@ -806,14 +806,14 @@
                                          currentFile = (char*) 0;
   }
                                       if (SrcFileName) {
-                                         free (currentFile);
-                                         currentFile = (char*) 0;
+                                         free (SrcFileName);
+                                         SrcFileName = (char*) 0;
   }
                                       if (WorkFileName) {
-                                         free (currentFile);
-                                         currentFile = (char*) 0;
+                                         _unlink (WorkFileName);
+                                         free (WorkFileName);
+                                         WorkFileName = (char*) 0;
   }
-                                      _unlink (WorkFileName);
                                       if (result == FATAL_EXIT_CODE)
                                          return result;
                                       len = strlen (WorkPath);
@@ -857,7 +857,7 @@
                       SrcFileName = (char*) malloc (len + strlen (BinFiles[i]) + 1);
                       sprintf (SrcFileName, "%s%s", WorkPath, BinFiles [i]);
   } else {
-                         SrcFileName = (char*) malloc (len + strlen (BinFiles) + 2);
+                         SrcFileName = (char*) malloc (len + strlen (BinFiles [i]) + 2);
                          sprintf (SrcFileName, "%s\\%s", WorkPath, BinFiles [i]);
   }
                   _unlink (SrcFileName);



