docno="lists-094-4498049"
received="Tue Oct  5 10:01:50 1999"
isoreceived="19991005140150"
sent="Tue, 5 Oct 1999 10:01:39 -0400"
isosent="19991005140139"
name="Daniel Veillard"
email="Daniel.Veillard@w3.org"
subject="Re: Compile failure"
id="19991005100139.L3345@w3.org"
charset="us-ascii"
inreplyto="199910051245.OAA20719&#64;tahiti.inrialpes.fr"
expires="-1"

To:"J. David Eisenberg"<nessus@best.com>
Cc:Irene.Vatton@inrialpes.fr,www-amaya@w3.org


On Tue, Oct 05, 1999 at 02:45:28PM +0200, Irene.Vatton@inrialpes.fr wrote:
> In-reply-to: Your message of Mon, 04 Oct 1999 23:55:25 -0400."
>              <37F97697.2D0F9592@best.com> 
> 
> We have some problem with the optimizer of the gcc code on redhat 6.
> A easy solution is to remove the option -O2 in the file Options.
> It should compile well after that.

  Not exactly, to be precise the Amaya includes do a braindead remapping
of memcopy and memmove to bcopy. Bcopy is a void function, and this
break macros in the includes of linux which assume (rightly) that memmove
returns an int. There used to be a memcpy() detection in autoconf for
amaya but it seems to have been removed, leading to the fact that HAVE_MEMCPY
is no more defined, etc ...
  The correct way to fix this is to apply the following patch and
restore the memcpy detection in automake:

*** thotlib/include/sysdep.h    1999/03/10 13:00:26     1.13
--- thotlib/include/sysdep.h    1999/06/25 12:21:50
*************** extern volatile noshare int errno;      /* no
*** 1002,1009 ****
--- 1002,1011 ----
  #define strrchr rindex
  #endif
  #if !defined(HAVE_MEMCPY) && !defined(WWW_MSWINDOWS)
+ #if !defined __GNUC__ || __GNUC__ < 2
  #define memcpy(d, s, n) bcopy((s), (d), (n))
  #define memmove(d, s, n) bcopy((s), (d), (n))
+ #endif
  #endif

  /* Standard headers */

  It's included in the source RPM for amaya-2.1 available at
   ftp://rpmfind.net/pub/amaya/

and unless you really want to developp code in the amaya framework, I suggest
to stick with the RPMs on RedHat

Daniel

-- 
Daniel.Veillard@w3.org | W3C, INRIA Rhone-Alpes  | Today's Bookmarks :
Tel : +33 476 615 257  | 655, avenue de l'Europe | Linux, WWW, rpmfind,
Fax : +33 476 615 207  | 38330 Montbonnot FRANCE | rpm2html, XML,
http://www.w3.org/People/W3Cpeople.html#Veillard | badminton, and Kaffe.



