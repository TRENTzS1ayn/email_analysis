docno="lists-097-5318109"
received="Tue Nov 19 11:54:47 2002"
isoreceived="20021119165447"
sent="Tue, 19 Nov 2002 10:54:12 -0600"
isosent="20021119165412"
name="Brent Hendricks"
email="brentmh@ece.rice.edu"
subject="Problem with ZAnnot escaping fixed [Was Re: GTK Amaya 6.4 can't post  annotations??]"
id="3DDA6CB4.9010004@ece.rice.edu"
charset="us-ascii"
inreplyto="20021119034314.GB874&#64;inrialpes.fr"
expires="-1"


To:jose.kahan@w3.org
Cc: Doug Daniels<rainking@rice.edu>,www-annotation@w3.org


Jose,

Thanks for spotting that.  When you first brought it up on the list I 
thought the error was in Charles' ruby client.  I was wrong :)  I took a 
deeper look this time and discovered the problem.  Right before 
releasing ZAnnot we switched from escaping string literals on the 
inbound side to escaping them on the outbound side.  But we never 
removed the inbound escaping code, so they were being escaped *twice*. 
For some strange reason, Annozilla was OK with this, but Amaya obviously 
(and quite correctly) is not. I've fixed this now in ZAnnot CVS.

Thanks again for your help debugging!

--Brent


Jose Kahan wrote:
> Doug,
> 
> Thanks for the extra info.
> 
> The error you are experiencing comes apparently from Zope. Look at the XML for
> the context:
> 
>     <a:Annotation
>     a:context="http://it.is.rice.edu/~rainking/finalTesting.html#xpointer(id(&amp;quot;para1&amp;quot;))"
> 
> It's doing a double convertion for the double quotes in
>  "para1"  from &quot; to &amp;quot;. This results in an invalid ID
> attribute (it starts with a '&'), so it's rejected by my XPointer
> parser.
> 
> Zope is converting the element <a:context> that Amaya is sending
> and converting it into an attribute. This is possible with literals in RDF.
> However, the convertion goes wrong at some time. It's probably just
> a confusion with the way that data should be stored on the dbase and
> how it should be transmitted later on.
> 
> I had signaled this error some days ago in the www-annotation list.
> 
> -jose
> 
> On Mon, Nov 18, 2002 at 02:43:33PM -0600, Doug Daniels wrote:
> 
>>Jose,
>>
>>The second,
>>http://rhaptos.ece.rice.edu/annotations/annot1037650894.23
>>uses an id("para1") style XPointer and fails to resolve.
>>
>>This leads me to believe that the problem Brent saw is in the xpointer id
>>function implementation in Amaya.
>>
>>The server rhaptos.ece.rice.edu/annotations is running the Zope
>>Annotations Server, and the client I'm using is your updated Amaya 6.4+.
>>I would test with the W3 server, but it's still down I think.
> 

-- 

-------------------------------------------------------------------------

"The programmer, like the poet, works only slightly removed from pure
  thought-stuff.  He builds his castles in the air, from air, creating
  by exertion of the imagination.  Few media of creation are so
  flexible, so easy to polish and rework, so readily capable of
  realizing grand conceptual structures."
                         -- Frederick Brooks, Jr., The Mythical Man Month



