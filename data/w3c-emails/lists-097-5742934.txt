docno="lists-097-5742934"
received="Sat Jan 18 21:47:53 2003"
isoreceived="20030119024753"
sent="Sat, 18 Jan 2003 21:47:51 -0500"
isosent="20030119024751"
name="Dan Brickley"
email="danbri@w3.org"
subject="Re: ZAnnot server and Windows"
id="20030119024751.GU19773@tux.w3.org"
charset="us-ascii"
inreplyto="Pine.LNX.4.30.0301182018390.7127-100000&#64;tux.w3.org"
expires="-1"

To: Charles McCathieNevile<charles@w3.org>
Cc:www-annotation@w3.org,brentmh@rice.edu



* Charles McCathieNevile <charles@w3.org> [2003-01-18 20:24-0500]
> 
> Hi folks,
> 
> I have installed the ZAnnot server o OS X (fairly easy to do) and on Windows
> (ridiculously easy). I will shortly have written up instructions for
> installation and configuration to make them run. But if anyone else has
> installed the ZAnnot server on Windows they might be able to help me out...
> 
> I had no problem posting Annotations to it, but for some reason it will not
> return them to me. I tested using the ruby command-line annodemo tools at
> http://www.w3.org/2001/sw/Europe/200209/annodemo and using Amaya 7.1 and it
> doesn't get anything. The same tools work fine to post to the server, and the
> annotations are shown in the server management interface, and on Moc OS X the
> same tools all work fine. I have only tested on Windows using localhost and
> annotating local files (I don't have a Windows machine that I can set up as
> an online server at the moment).
> 
> Any help available?
> 
> The very rough draft of instructions that I am working on is at
> http://www.w3.org/2001/sw/Europe/reports/annotation_demo_server_report/zannot-inst
> if anyone wants a preview of an unstable and incomplete draft...
> 

Thanks, this is a good start. I'm trying to test this under Debian. Brief notes so far:

apt-get install zope
...just worked. It sets up a user and runs the server for you too.

Default Zope port: seems to be 9673 rather than 8080, currently at least. This 
confused me for a few minutes.

http://localhost:9673/manage/

aside:
[[
I was out of luck when I tried to reconfigure Zope by running:
 dpkg --configure zope
I had to remove and reinstall it, deleting some files by hand, as the only 
quick way I could find to blank down the admin user I'd created and start afresh.

apt-get remove zope
rm -rf /var/lib/zope

The reason I re-installed was for some reason, when I first set up an admin 
user I followed your guide and asked for a restriction to 'localhost' for domain, but 
the way my box is set up, that doesn't work and I couldn't log in as the Zope 
administrator.
]]

What I did next:

action: selected 'acl_users' folder.
msg: "there are no users defined."

action: selected [Add...] button
msg: "To add a new user, enter ... (user details)"

action: I created a user 'annouser', and selected 'manager' from Roles, then [Add...]
msg: The following users have been defined. Click on the name of a user to edit that user. 

So now everything _except_ the Annotations stuff is set up fine. 

There isn't a Debian package of ZAnnot that I'm aware of, so (via Google -- 
Charles can you add a link to the ZAnnot pages?) I follow the instructions in 
http://www.zope.org/Members/Crouton/ZAnnot/readme


Here's what I did to install ZAnnot on top of my working Zope system:

  cd lib/python/Products/
  cd /usr/lib/zope/lib/python/Products; wget http://www.zope.org/Members/Crouton/ZAnnot/ZAnnot-0.3.tgz
  tar -zxvf ZAnnot-0.3.tgz
  zopectl restart


Then closing browser and restarting it, I log into http://localhost:9673/manage/ 
as the annouser I just created.

I'm now at step: "3. Add an annotation server object" of the 
http://www.w3.org/2001/sw/Europe/reports/annotation_demo_server_report/zannot-inst
howto, and this is where I get lost.

I don't know enough about Zope, ZANnot etc to know if my setup is OK. From the 
ZAnnot README I just unpacked:

[[
  Setting up your annotation server

    Add an instance of the 'Annotation Server' object somewhere in
    your Zope site.  That's it, you're ready to go!  You may want to
    create accounts for users allowed to post annotations.  See the
    Zope documentation for instructions on how to create and manage
    users.
]]

At this point, I can't see an 'Annotation Server' type in the 
'Select type to add' form widget at http://localhost:9673/manage/ 
...should it appear alongside 'File', 'Folder', 'DTML Document' etc etc?


I've also tried restartign the server through the Zope Web interface. No joy.


Nosing a bit further, under Control_Panel, 'Product Management', I find a list 
of Zope addons, ie. 'Products'. Helpfully, ZAnnot is listed as:

 
 ZAnnot (Broken product ZAnnot) 

...complete with an icon indicating a broken installation. Selecting that 
gets me some useful debug information:

[[
Import Traceback
Traceback (most recent call last):
  File "/usr/lib/zope/lib/python/OFS/Application.py", line 531, in import_product
    product=__import__(pname, global_dict, global_dict, silly)
  File "/usr/lib/zope/lib/python/Products/ZAnnot/__init__.py", line 1, in ?
    import ZAnnot
  File "/usr/lib/zope/lib/python/Products/ZAnnot/ZAnnot.py", line 15, in ?
    from AnnotRequestParser import AnnotRequestParser
  File "/usr/lib/zope/lib/python/Products/ZAnnot/AnnotRequestParser.py", line 8, in ?
    import xml.parsers.expat
ImportError: No module named xml.parsers.expat
]]


At this point I realise I have no idea which version of Python Zope is using, 
there are a couple on the system. I assume 2.1 as that's what 'python' is:

/usr/bin/python -v
# /usr/lib/python2.1/site.pyc matches /usr/lib/python2.1/site.py

So I do:

 apt-cache search python | grep -i xml
...to find likely looking packages, and correctly guess that:

apt-get install python2.1-xml

zopectl restart

....will do the business.

Revisiting the control panel in Zope after it restarts, Anno stuff is OK and 
appears in the 'select type to add' dropdown.

I successfully create a folder called 'anno' and a server inside it called 'server'. 

Seems OK so far, but I've not tested things further yet. Visiting 
http://localhost:9673/anno/server on the offchance it returns a page didn't work, 
the browser just hangs. Not sure if that is because there's no data there, because 
the access control settings are wrong, or some other reason.

Anyway, I'm nearly there! Will revisit this later in the week. Any tips welcomed...

cheers,

Dan



